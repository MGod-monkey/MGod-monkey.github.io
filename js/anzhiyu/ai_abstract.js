!function(){const{randomNum:e,basicWordCount:t,btnLink:n,key:i,Referer:o,gptName:a,switchBtn:r,mode:l}=GLOBAL_CONFIG.postHeadAiDescription,{title:c,postAI:s,pageFillDescription:d}=GLOBAL_CONFIG_SITE;let y,m=-1,u=!0,f=l,h=0,p=null,g=!1,T=null;const b=document.querySelector(".post-ai-description"),M=b.querySelector(".ai-title .anzhiyufont.anzhiyu-icon-arrow-rotate-right");let v=b.querySelector(".anzhiyu-icon-circle-dot");const E=b.querySelector(".ai-explanation");let k="",L="",I=600,S=0,A=0,G=[],q=0;const w=new IntersectionObserver((e=>{let t=e[0].isIntersecting;u=t,u&&(I=0===S?200:20,G[1]=setTimeout((()=>{A&&(S=0,A=0),0===S&&(E.innerHTML=k.charAt(0)),requestAnimationFrame($)}),I))}),{threshold:0}),x=[function(){C("tianli"==f?"我是MGodmonkey世界的MOSS，点击下方的按钮，让我生成本文简介、推荐相关文章等。":`我是文章辅助AI: ${a} GPT，点击下方的按钮，让我生成本文简介、推荐相关文章等。`)},function(){M.click()},function(){S=0,A=1,j(),u=!1,q=0,E.innerHTML="生成中. . .",k="",L="",w.disconnect(),G[2]=setTimeout((()=>{E.innerHTML=function(){let e=document.querySelectorAll(".relatedPosts-list a");if(!e.length){const t=document.querySelector(".card-widget.card-recent-post");if(!t)return"";e=t.querySelectorAll(".aside-list-item a");let n="";for(let t=0;t<e.length;t++){const i=e[t];n+=`<div class="ai-recommend-item"><span class="index">${t+1}：</span><a href="javascript:;" onclick="pjax.loadUrl('${i.href}')" title="${i.title}" data-pjax-state="">${i.title}</a></div>`}return`很抱歉，无法找到类似的文章，你也可以看看本站最新发布的文章：<br /><div class="ai-recommend">${n}</div>`}let t="";for(let n=0;n<e.length;n++){const i=e[n];t+=`<div class="ai-recommend-item"><span>推荐${n+1}：</span><a href="javascript:;" onclick="pjax.loadUrl('${i.href}')" title="${i.title}" data-pjax-state="">${i.title}</a></div>`}return`推荐文章：<br /><div class="ai-recommend">${t}</div>`}()}),600)},function(){C("正在前往博客主页...",!1),G[2]=setTimeout((()=>{window.pjax?pjax.loadUrl("/"):location.href=location.origin}),1e3)}],B=b.querySelectorAll(".ai-btn-item");function $(e){if(u)if($.start||($.start=e),q=e-$.start,q>=20){if($.start=e,S<L-1){let e=k.charAt(S+1),t=/[,.，。!?！？]/.test(e)?150:20;E.firstElementChild&&E.removeChild(E.firstElementChild),E.innerHTML+=e;let n=document.createElement("div");n.className="ai-cursor",E.appendChild(n),S++,150===t&&(b.querySelector(".ai-explanation .ai-cursor").style.opacity="0.2"),S===L-1&&(w.disconnect(),E.removeChild(E.firstElementChild)),G[0]=setTimeout((()=>{requestAnimationFrame($)}),t)}}else requestAnimationFrame($)}function j(){G.length&&G.forEach((e=>{e&&clearTimeout(e)}))}function C(e,t=!0){S=0,A=1,j(),u=!1,q=0,w.disconnect(),E.innerHTML=t?"生成中. . .":"请等待. . .",k=e,L=k.length,w.observe(b)}async function H(e=t){"tianli"===f?await async function(e){S=0,A=1,j(),u=!1,q=0,w.disconnect(),e=Math.max(10,Math.min(2e3,e));const t={key:i,Referer:o},n=(c+d).trim().substring(0,e),a={key:t.key,content:n,url:location.href},r={method:"POST",headers:{"Content-Type":"application/json",Referer:t.Referer},body:JSON.stringify(a)};console.info(n.length);try{let e,t=null;t&&clearInterval(t),t=setInterval((()=>{const e="生成中"+".".repeat(A);E.innerHTML=e,A=A%3+1}),500);const n=await fetch("https://summary.tianli0.top/",r);let i;i=403===n.status?{summary:"403 refer与key不匹配。"}:500===n.status?{summary:"500 系统内部错误"}:await n.json(),e=i.summary.trim(),T=i.id,setTimeout((()=>{M.style.opacity="1"}),300),C(e||"摘要获取失败!!!请检查Tianli服务是否正常!!!"),clearInterval(t)}catch(e){console.error(e),E.innerHTML="发生异常"+e}}(e):function(){const e=s.split(",").map((e=>e.trim()));if(1!==e.length){let t=Math.floor(Math.random()*e.length);for(;t===m;)t=Math.floor(Math.random()*e.length);m=t,C(e[t])}else C(e[0]);setTimeout((()=>{M.style.opacity="1"}),600)}()}Array.from(B).filter((e=>"go-tianli-blog"!==e.id)).forEach(((e,t)=>{e.addEventListener("click",(()=>{x[t]()}))})),document.getElementById("ai-tag").addEventListener("click",(function(){"tianli"===f?(b.querySelectorAll(".ai-btn-item").forEach((e=>e.style.display="none")),document.getElementById("go-tianli-blog").style.display="block",C("你好，我是MGodmonkey世界MOSS，是一个基于GPT-4的生成式AI。我在这里只负责摘要的预生成和显示，你无法与我直接沟通，如果你也需要一个这样的AI摘要接口，可以在下方购买。")):(b.querySelectorAll(".ai-btn-item").forEach((e=>e.style.display="block")),document.getElementById("go-tianli-blog").style.display="none",C(`你好，我是本站摘要生成助理${a} GPT，是一个基于GPT-4的生成式AI。我在这里只负责摘要的预生成和显示，你无法与我直接沟通。`))})),M.addEventListener("click",(function(){const n=(c+d).trim().substring(0,t);if(M.style.opacity="0.2",M.style.transitionDuration="0.3s",M.style.transform="rotate("+360*h+"deg)",n.length<=t){let t=n.length-Math.floor(Math.random()*e);for(;t===y||n.length-t===y;)t=n.length-Math.floor(Math.random()*e);y=t,H(t)}else{let i=Math.floor(Math.random()*e)+t;for(;i===y||n.length-i===y;)i=Math.floor(Math.random()*e)+t;H(i)}h++})),document.getElementById("go-tianli-blog").addEventListener("click",(()=>{window.open(n,"_blank")})),v.addEventListener("click",(async function(){if(!T)return void anzhiyu.snackbarShow("摘要还没加载完呢，请稍后。。。");if(v=b.querySelector(".anzhiyu-icon-circle-dot"),v.style.opacity="0.2",p&&!g)return p.pause(),g=!0,v.style.opacity="1",v.style.animation="",void(v.style.cssText="animation: ''; opacity: 1;cursor: pointer;");if(p&&g)return p.play(),g=!1,void(v.style.cssText="animation: breathe .5s linear infinite; opacity: 0.2;cursor: pointer");const e={key:i,Referer:o},t=new URLSearchParams({key:e.key,id:T}),n={method:"GET",headers:{"Content-Type":"application/json",Referer:e.Referer}};try{const e=await fetch(`https://summary.tianli0.top/audio?${t}`,n);if(403===e.status)console.error("403 refer与key不匹配。");else if(500===e.status)console.error("500 系统内部错误");else{const t=await e.blob(),n=URL.createObjectURL(t);p=new Audio(n),p.play(),v.style.cssText="animation: breathe .5s linear infinite; opacity: 0.2;cursor: pointer",p.addEventListener("ended",(()=>{p=null,v.style.opacity="1",v.style.animation=""}))}}catch(e){console.error("请求发生错误❎")}})),r&&document.getElementById("ai-Toggle").addEventListener("click",(function(){f="tianli"===f?"local":"tianli","tianli"===f?(document.getElementById("ai-tag").innerHTML="MGodのGPT",v.style.opacity="1",v.style.cursor="pointer"):(v.style.opacity="0",v.style.cursor="auto",(document.getElementById("go-tianli-blog").style.display="block")&&(document.querySelectorAll(".ai-btn-item").forEach((e=>e.style.display="block")),document.getElementById("go-tianli-blog").style.display="none"),document.getElementById("ai-tag").innerHTML=a+" GPT");H()})),H(),document.getElementById("ai-tag").innerHTML="tianli"===f?"MGodのGPT":a+" GPT"}();